# 検索エンジン自作入門～手を動かしながら見渡す検索の舞台裏

[検索エンジン自作入門～手を動かしながら見渡す検索の舞台裏 | 山田浩之, 末永匡 | 工学 | Kindleストア | Amazon](https://www.amazon.co.jp/dp/B00NUZ32MU/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)

やっていき。

## 一章

### 検索エンジンの構成

* この本では検索エンジンとは**全文検索エンジン**を指す。

#### コンポーネント

一般的に以下の四つから構成されている。

##### Indexer

検索対象のテキストからインデックスを作成する。

私が見たことあるやつだと、形態素まで分解した上で、スコアリングしたりしてた。

スコアリングは別の箇所でやってたのかな？

##### Index Manager

索引をもつ箇所。Indexerから解析した結果を受け取って保存したり、

検索時にIndex Searcherへデータを渡したりもする。

保存時にデータを圧縮したりするテクニックとかある。

##### Index Searcher

インデックスを用いて、検索処理を行う。

大体のやつは、検索クエリに応じて、Index Managerに保存してあるスコアリングしたものを産出して、

スコアの降順に結果を分割して返す。

##### Document Manager

文字通り検索対象のドキュメントを保存するコンポーネント。データベース。

#### その他、付随するコンポーネント

##### クローラ

文書を集めるやつ。

Googleの検索エンジンで言うところの、ウェブ上の文書を収集するシステム。

##### ランキングシステム

検索対象をスコアリングするシステムと書いてあった。

あれ、これIndexerの役割じゃないの。まあいいか。

まあ切り離しといたほうがいいか。アルゴリズム次第だろうし。

### 高速化実現のためのインデックスの仕組み

#### grep型探索

文字通り全文を検索する。確実だろうけど遅い。

文字列の全操作の方法にもKMPやらBM法やらがある。

KMP->

[クヌース–モリス–プラット法 - Wikipedia](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%8C%E3%83%BC%E3%82%B9%E2%80%93%E3%83%A2%E3%83%AA%E3%82%B9%E2%80%93%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E6%B3%95)

BM->

[ボイヤー-ムーア文字列検索アルゴリズム - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%9C%E3%82%A4%E3%83%A4%E3%83%BC-%E3%83%A0%E3%83%BC%E3%82%A2%E6%96%87%E5%AD%97%E5%88%97%E6%A4%9C%E7%B4%A2%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0)

#### インデックスを用いる方法

事前にインデックスを作成して、それを使って検索を行う方法。

大量の文書の検索時にもそんなに検索速度が変わらないのが良いところ。

大体の検索エンジンがこれを使ってる。

GoogleやYahooは転置インデックスを使っているらしい。

##### 転置インデックスの仕組み

書籍の索引と同じ。

### 転置インデックス

[転置インデックス - Wikipedia](https://ja.wikipedia.org/wiki/%E8%BB%A2%E7%BD%AE%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9)

* 文書レベルの転置リスト

各単語がどの文章に存在しているかを持つ。

* 単語レベルの転置リスト

各単語がどの文章のどこに存在しているか。

実装には木構造を使う。

[トライ木 - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%88%E3%83%A9%E3%82%A4%E6%9C%A8)

知らんかったのでググってリンクつけた。

#### 二分探索木で実装する場合

* 辞書をメモリに全て載せることができる場合、非常に高速。

* 二次記憶装置(HDD, SSD)にデータを置いた場合、遅い。

大抵はブロック単位で入出力を行うため。

#### B+木

[B+木 - Wikipedia](https://ja.wikipedia.org/wiki/B%2B%E6%9C%A8)

### 実装

ポスティングリストは大体以下の三つで構成される

* 文書ID

* 文書のオフセットリスト

* Term Frequency

これらを圧縮して保存するのが基本。

### 転置インデックスの構築

基本的には二次記憶を用いた転置インデックスの構築を行う。

以下種類。

* ソートに基づくインデックス構築

* マージに基づくインデックス構築

#### 静的、動的インデックス構築

検索するたびにインデックスを再構築する、いわゆるバッチ処理的な構築方法か、

それとも追加のたびにインデックスを構築するか。

鮮度が重要な物に関しては動的なものが採用されることが多い。

### 検索したい文書を用意する

クローラとか使うのもいいけど、ここのブログ記事とかをそのまま使ってのもいいかもしれないね。

#### データの整形

どこの部分を取り出すのかを処理に入れとかないといけない。

後JSONやHTMLを読み込むにしてもParse処理が必要。まあそれは大抵の言語ではライブラリがやってくれる。

PDFとかは何度か書いたことあるけどライブラリ使ってもだるかった。

## 所感

ふんわりつかめたと思う。しかし、途中で書いてあったコードとかの意味はよくわからなかった。説明見てなんとかって感じ。
